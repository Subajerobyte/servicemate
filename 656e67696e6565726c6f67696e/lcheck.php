<?phpini_set('memory_limit','1024M');include('../session.php');include('../mukkiyam/dbc.php');include('../mukkiyam/db.php');function jbsencrypt($key, $str){$privateKey 	= 'WERULETHEWORLD';$secretKey 		= $key;$encryptMethod      = "AES-256-CBC";$string 		= $str;$key = hash('sha256', $privateKey);$ivalue = substr(hash('sha256', $secretKey), 0, 16);$result = openssl_encrypt($string, $encryptMethod, $key, 0, $ivalue);return $output = base64_encode($result);}function jbsdecrypt($key, $str){$privateKey 	= 'WERULETHEWORLD';$secretKey 		= $key;$encryptMethod      = "AES-256-CBC";$stringEncrypt      = $str;$key    = hash('sha256', $privateKey);$ivalue = substr(hash('sha256', $secretKey), 0, 16); // sha256 is hash_hmac_algoreturn $output = openssl_decrypt(base64_decode($stringEncrypt), $encryptMethod, $key, 0, $ivalue);}function sendNotifications($title,$playerid,$message,$companysiteurl,$calltid){$content = array("en" => $message);$headings = array("en" => $title);$fields = array('app_id' => "2c0c6d16-4604-4e32-9514-38b6fdb1d3ee",'include_player_ids' => array($playerid),'headings' => $headings,'large_icon' =>"https://jerobyte.com/1637028036/img/jerobytelogo.png",'url'=> "https://jerobyte.com/".$companysiteurl."/61646d696e6c6f67696e/callsedit.php?calltid=".$calltid,'contents' => $content);$fields = json_encode($fields);$ch = curl_init();curl_setopt($ch, CURLOPT_URL, "https://onesignal.com/api/v1/notifications");curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/json; charset=utf-8','Authorization: Basic NTY4NTI1NmQtNDg1My00NjI0LWJlNjktMDA0NzliZTQxM2E3'));curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);curl_setopt($ch, CURLOPT_HEADER, FALSE);curl_setopt($ch, CURLOPT_POST, TRUE);curl_setopt($ch, CURLOPT_POSTFIELDS, $fields);curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);$response = curl_exec($ch);curl_close($ch);return $response;}global $wrongPwdErr, $accountNotExistErr, $emailPwdErr, $verificationRequiredErr, $email_empty_err, $pass_empty_err;if(isset($_SESSION['logged_in'])) {$email_signin        = $_SESSION['email'];$password_signin     = $_SESSION['kadavuchol'];// clean data$user_email = filter_var($email_signin, FILTER_SANITIZE_EMAIL);$pswd = mysqli_real_escape_string($connection, $password_signin);$sql = "SELECT * From jrcengineer WHERE username = '{$email_signin}' ";$query = mysqli_query($connection, $sql);$rowCount = mysqli_num_rows($query);if(!$query){die("SQL query failed: " . mysqli_error($connection));}if(!empty($email_signin) && !empty($password_signin)){if(!preg_match("/^(?=.*\d)(?=.*[@#\-_$%^&+=ยง!\?])(?=.*[a-z])(?=.*[A-Z])[0-9A-Za-z@#\-_$%^&+=ยง!\?]{6,20}$/", $pswd)) {$wrongPwdErr = '<div class="alert alert-danger">Password should be between 6 to 20 charcters long, contains atleast one special chacter, lowercase, uppercase and a digit.</div>';}if($rowCount <= 0) {header("Location:../logout.php");} else {// Fetch user data and store in php sessionwhile($row = mysqli_fetch_array($query)) {$id            = $row['id'];$engineerid            = $row['id'];$engineername     = $row['engineername'];$_SESSION['engineerid']=$engineerid;$_SESSION['engineername']=$engineername;$_SESSION['eligiblecalls']=$row['eligiblecalls'];$designation      = $row['designation'];$email         = $row['username'];$_SESSION['username']=$username;$pass_word     = $row['password'];$useremail=$email;$_SESSION['email']=$email;$address1     = $row['address1'];$address2     = $row['address2'];$area     = $row['area'];$district     = $row['district'];$pincode     = $row['pincode'];$contact     = $row['contact'];$mobile   = $row['mobile'];$_SESSION['engineermobile']=$mobile;
$phone     = $row['phone'];$avatar     = $row['avatar'];$_SESSION['avatar']=$avatar;$latlong         = $row['latlong'];$enabled     = $row['enabled'];$engsignature     = $row['signature'];$_SESSION['engineersignature']=$engsignature;
$compprefix     = $row['compprefix'];$compno     = $row['compno'];$updates     = $row['updates'];$targetpoint     = $row['targetpoint'];$eligiblecalls     = $row['eligiblecalls'];$celigiblecalls     = $row['celigiblecalls'];$sqlcompany = "SELECT companyid, companyname, companyshortname, address1, address2, area, district, statecode, gstno, cinno, pincode, contact, phone, mobile, mobile1, mobile2, email, latlong, avatar, qrcode, salesemail, panno, bankname, acno, branchname, ifscode,perkm, authsign, companyseal, preventive, preventivealert, warrantyexpire, amcexpire, amcmaintenance, amcmaintenancealert, amcrenewal, lifetime,headerimage,footerimage,serprefix,amcprefix,estprefix,callhandlingid,coordinatorid,shortname,currentyear,financialyear,month,runningserial  From jrccompany";$querycompany = mysqli_query($connection, $sqlcompany);$infocompany = mysqli_fetch_array($querycompany);$companyid=$infocompany['companyid'];$sqlcompany1 = "SELECT siteurl, secsystem, encsystem, dbloc, empcur, empmax, slotmax, empprice, valexp, businesstype, liveplan From jrccompany where id='".$infocompany['companyid']."'";$querycompany1 = mysqli_query($connection1, $sqlcompany1);$infocompany1 = mysqli_fetch_array($querycompany1);$businesstype=mysqli_real_escape_string($connection1, $infocompany1['businesstype']);$businesstypesarray=explode(',',$businesstype);$_SESSION['companysiteurl']=mysqli_real_escape_string($connection, $infocompany1['siteurl']);$_SESSION['companyname']=mysqli_real_escape_string($connection, $infocompany['companyname']);$_SESSION['qrcode']=mysqli_real_escape_string($connection, $infocompany['qrcode']);$_SESSION['companyshortname']=mysqli_real_escape_string($connection, $infocompany['companyshortname']);$_SESSION['companyaddress1']=mysqli_real_escape_string($connection, $infocompany['address1']);$_SESSION['companyaddress2']=mysqli_real_escape_string($connection, $infocompany['address2']);$_SESSION['companyarea']=mysqli_real_escape_string($connection, $infocompany['area']);$_SESSION['companydistrict']=mysqli_real_escape_string($connection, $infocompany['district']);$_SESSION['companystatecode']=mysqli_real_escape_string($connection, $infocompany['statecode']);$_SESSION['companygstno']=mysqli_real_escape_string($connection, $infocompany['gstno']);$_SESSION['companycinno']=mysqli_real_escape_string($connection, $infocompany['cinno']);$_SESSION['companypincode']=mysqli_real_escape_string($connection, $infocompany['pincode']);$_SESSION['companycontact']=mysqli_real_escape_string($connection, $infocompany['contact']);$_SESSION['companyphone']=mysqli_real_escape_string($connection, $infocompany['phone']);$_SESSION['companymobile']=mysqli_real_escape_string($connection, $infocompany['mobile']);$_SESSION['companymobile1']=mysqli_real_escape_string($connection, $infocompany['mobile1']);$_SESSION['companymobile2']=mysqli_real_escape_string($connection, $infocompany['mobile2']);$_SESSION['companyemail']=mysqli_real_escape_string($connection, $infocompany['email']);$_SESSION['companylatlong']=mysqli_real_escape_string($connection, $infocompany['latlong']);$_SESSION['companylogo']=mysqli_real_escape_string($connection, $infocompany['avatar']);$_SESSION['companyseal']=mysqli_real_escape_string($connection, $infocompany['companyseal']);$_SESSION['companysalesemail']=mysqli_real_escape_string($connection, $infocompany['salesemail']);$_SESSION['companypanno']=mysqli_real_escape_string($connection, $infocompany['panno']);$_SESSION['companybankname']=mysqli_real_escape_string($connection, $infocompany['bankname']);$_SESSION['companyacno']=mysqli_real_escape_string($connection, $infocompany['acno']);$_SESSION['companybranchname']=mysqli_real_escape_string($connection, $infocompany['branchname']);$_SESSION['companyifscode']=mysqli_real_escape_string($connection, $infocompany['ifscode']);$_SESSION['companyperkm']=mysqli_real_escape_string($connection, $infocompany['perkm']);$_SESSION['companyauthsign']=mysqli_real_escape_string($connection, $infocompany['authsign']);$_SESSION['companyheaderimage']=mysqli_real_escape_string($connection, $infocompany['headerimage']);$_SESSION['companyfooterimage']=mysqli_real_escape_string($connection, $infocompany['footerimage']);$_SESSION['preventive']=mysqli_real_escape_string($connection, $infocompany['preventive']);$_SESSION['preventivealert']=mysqli_real_escape_string($connection, $infocompany['preventivealert']);$_SESSION['warrantyexpire']=mysqli_real_escape_string($connection, $infocompany['warrantyexpire']);$_SESSION['amcmaintenance']=mysqli_real_escape_string($connection, $infocompany['amcmaintenance']);$_SESSION['amcmaintenancealert']=mysqli_real_escape_string($connection, $infocompany['amcmaintenancealert']);$_SESSION['amcexpire']=mysqli_real_escape_string($connection, $infocompany['amcexpire']);$_SESSION['amcrenewal']=mysqli_real_escape_string($connection, $infocompany['amcrenewal']);$_SESSION['lifetime']=mysqli_real_escape_string($connection, $infocompany['lifetime']);$_SESSION['amcprefix']=mysqli_real_escape_string($connection, $infocompany['amcprefix']);$_SESSION['serprefix']=mysqli_real_escape_string($connection, $infocompany['serprefix']);$_SESSION['estprefix']=mysqli_real_escape_string($connection, $infocompany['estprefix']);$_SESSION['coordinatorid']=mysqli_real_escape_string($connection, $infocompany['coordinatorid']);$_SESSION['callhandlingid']=mysqli_real_escape_string($connection, $infocompany['callhandlingid']);$_SESSION['currentyear']='';$_SESSION['financialyear']='';$_SESSION['shortname']='';$_SESSION['month']='';$_SESSION['runningserial']='';if($infocompany['shortname']=='Company Short Name'){$_SESSION['shortname']=$_SESSION['companyshortname'];}if($infocompany['currentyear']=='2-Digit Current Year'){$_SESSION['currentyear']=date('y');}else if($infocompany['currentyear']=='4-Digit Current Year'){$_SESSION['currentyear']=date('Y');}if($infocompany['financialyear']=='Financial Year 2 digit Start & End'){if(date('m') >= 4){$currentyear=date('y');$nextyear=date('y')+1;$_SESSION['financialyear']=$currentyear.$nextyear;}}else if($infocompany['financialyear']=='Financial Year 4 digit Start & End'){if(date('m') >= 4){$currentyear=date('Y');$nextyear=date('Y')+1;$_SESSION['financialyear']=$currentyear.$nextyear;}}if($infocompany['month']=='2-Digit Month'){$_SESSION['month']=date('m');}else if($infocompany['month']=='Month In Alphabet'){$_SESSION['month']=date('M');}$empmax=mysqli_real_escape_string($connection1, $infocompany1['empmax']);$empcur=mysqli_real_escape_string($connection1, $infocompany1['empcur']);$slotmax=mysqli_real_escape_string($connection1, $infocompany1['slotmax']);$empprice=mysqli_real_escape_string($connection1, $infocompany1['empprice']);$dbloc=mysqli_real_escape_string($connection1, $infocompany1['dbloc']);$valexp=mysqli_real_escape_string($connection1, $infocompany1['valexp']);$secsystem=mysqli_real_escape_string($connection1, $infocompany1['secsystem']);$encsystem=mysqli_real_escape_string($connection1, $infocompany1['encsystem']);if(($infocompany1['encsystem']=='1')||($infocompany1['encsystem']=='2')){if(!isset($_SESSION['encpass'])){header("Location: ../logout.php");}}$liveplan=mysqli_real_escape_string($connection1, $infocompany1['liveplan']);if($valexp!=""){$valdate1 = date('Y-m-d');$valdate2 = $valexp;$diff = strtotime($valdate2) - strtotime($valdate1);$years = floor($diff / (365*60*60*24));$months = floor(($diff - $years * 365*60*60*24) / (30*60*60*24));$valintervaldays = floor(($diff)/ (60*60*24));if($valintervaldays<-14){session_unset();session_destroy();if (isset($_SERVER['HTTP_COOKIE'])) {$cookies = explode(';', $_SERVER['HTTP_COOKIE']);foreach($cookies as $cookie) {$parts = explode('=', $cookie);$name = trim($parts[0]);setcookie($name, '', time()-1000);setcookie($name, '', time()-1000, '/');}}header("Location: ../index.php?error=Your Subscription Validity has been Expired. Kindly Renew your Subscription Period");}}$sqllayoutcustomers=mysqli_query($connection, "select * from jrclayoutcustomers");$infolayoutcustomers=mysqli_fetch_array($sqllayoutcustomers);$sqllayoutinvoice=mysqli_query($connection, "select * from jrclayoutinvoice");$infolayoutinvoice=mysqli_fetch_array($sqllayoutinvoice);$sqllayoutproducts=mysqli_query($connection, "select * from jrclayoutproducts");$infolayoutproducts=mysqli_fetch_array($sqllayoutproducts);$sqllayoutcall=mysqli_query($connection, "select * from jrclayoutcall");$infolayoutcall=mysqli_fetch_array($sqllayoutcall);$sqllayoutservice=mysqli_query($connection, "select * from jrclayoutservice");$infolayoutservice=mysqli_fetch_array($sqllayoutservice);$sqlquotationsettings=mysqli_query($connection, "select * from jrcquotsettings");$infoquotationsettings =mysqli_fetch_array($sqlquotationsettings);$sqlamcquotation=mysqli_query($connection, "select * from jrcamcquotationtype");$infoamcquotation =mysqli_fetch_array($sqlamcquotation);}// Allow only verified userif($enabled == '0') {if($email_signin == $email && $password_signin == md5($pass_word)) {} else {header("Location:../logout.php");}} else {header("Location:../logout.php");}}} else {header("Location:../logout.php");}}else{header("Location:../logout.php");}?>