<?phpinclude('lcheck.php');if($calladd=='0'){	header("location: dashboard.php");}$latlong="";if(isset($_GET['id'])){$id=mysqli_real_escape_string($connection,$_GET['id']);$sqlselect = "SELECT * From jrcxl where tdelete='0' and  id='".$id."' order by consigneename asc";				          $queryselect = mysqli_query($connection, $sqlselect);        $rowCountselect = mysqli_num_rows($queryselect);                 if(!$queryselect){           die("SQL query failed: " . mysqli_error($connection));        }                 if($rowCountselect > 0) 		{			$count=1;			$rowselect = mysqli_fetch_array($queryselect);			$consigneeid=$rowselect['consigneeid'];			$sqlselect1 = "SELECT latlong, consigneename From jrcconsignee where id='".$consigneeid."' order by consigneename asc";				  			$queryselect1 = mysqli_query($connection, $sqlselect1);			$rowCountselect1 = mysqli_num_rows($queryselect1);			 			if(!$queryselect1){			   die("SQL query failed: " . mysqli_error($connection));			}			 			if($rowCountselect1 > 0) 			{				$count=1;				$rowselect1 = mysqli_fetch_array($queryselect1);				$latlong=$rowselect1['latlong'];			}				}}?><!DOCTYPE html><html lang="en"><head>  <meta charset="utf-8">  <meta http-equiv="X-UA-Compatible" content="IE=edge">  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">  <meta name="description" content="">  <meta name="author" content="">  <title><?=$_SESSION['companyname']?> - Jerobyte - Add New Complaint Call</title>    <link href="../../1637028036/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css"><meta name="theme-color" content="#3d8eb9">  <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">    <link href="../../1637028036/css/aarkayen-jrc-2.min.css" rel="stylesheet"> <?php include('../../gstag.php'); ?> <link rel="stylesheet" href="../../1637028036/vendor/jquery-ui/jquery-ui.css" />  <link href="../../1637028036/vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">   <link rel="stylesheet" href="../../1637028036/vendor/jquery-ui/jquery-ui.css" />   <link rel="stylesheet"  href="../../1637028036/vendor/select2/css/select2.min.css">   	<script>      let map;function initMap(){	initMap1();	initMap2();}      function initMap1() {        map = new google.maps.Map(document.getElementById("map_div"), {			<?php			if($latlong!='')			{			?>	          center: new google.maps.LatLng(<?=$latlong?>),		  <?php			}			else			{			?>	          center: new google.maps.LatLng(10.826625682767068, 78.68206400238414),		  <?php			}			?>          zoom: 14,		  mapType: 'styledMap',		  showTooltip: true,			showInfoWindow: true,			useMapTypeControl: true,			maps: {			  // Your custom mapTypeId holding custom map styles.			  styledMap: {				name: 'Styled Map', // This name will be displayed in the map type control.				styles: [				  {featureType: 'poi.attraction',				   stylers: [{color: '#fce8b2'}]				  },				  {featureType: 'road.highway',				   stylers: [{hue: '#0277bd'}, {saturation: -50}]				  },				  {featureType: 'road.highway',				   elementType: 'labels.icon',				   stylers: [{hue: '#000'}, {saturation: 100}, {lightness: 50}]				  },				  {featureType: 'landscape',				   stylers: [{hue: '#259b24'}, {saturation: 10}, {lightness: -22}]				  }			]}}        });		const contentString ='Customer Location';		const infowindow = new google.maps.InfoWindow({			content: contentString,		  });        const iconBase =          "http://maps.google.com/mapfiles/ms/icons/";        const icons = {          parking: {            icon: iconBase + "blue-dot.png",          },          library: {            icon: iconBase + "library_maps.png",          },          info: {            icon: iconBase + "red-dot.png",          },        };        const features = [		<?php		$sqlselect = "SELECT latlong, engineername From jrcengineer where latlong!='' and latlong!='$latlong' order by engineername asc";				          $queryselect = mysqli_query($connection, $sqlselect);        $rowCountselect = mysqli_num_rows($queryselect);                 if(!$queryselect){           die("SQL query failed: " . mysqli_error($connection));        }                 if($rowCountselect > 0) 		{			$count=1;			while($rowselect = mysqli_fetch_array($queryselect)) 			{				?>          {            position: new google.maps.LatLng(<?=$rowselect['latlong']?>),            type: "info",			title: "<?=$rowselect['engineername']?>",          },		  <?php			}		}			?>			<?php			if($latlong!='')			{			?>          {            position: new google.maps.LatLng(			 <?=$latlong?>            ),			type: "parking",			title: 'Customer Location',          },		  <?php			}			?>        ];        // Create markers.        for (let i = 0; i < features.length; i++) {          const marker = new google.maps.Marker({            position: features[i].position,            icon: icons[features[i].type].icon,            map: map,			title: features[i].title,          });		  google.maps.event.addListener(marker, "click", function(evt) {  			infowindow.setContent(this.get('title'));			infowindow.open(map,this);			});         }      }	  function initMap2() {        map = new google.maps.Map(document.getElementById("map_div2"), {			<?php			if($latlong!='')			{			?>	          center: new google.maps.LatLng(<?=$latlong?>),		  <?php			}			else			{			?>	          center: new google.maps.LatLng(10.826625682767068, 78.68206400238414),		  <?php			}			?>          zoom: 14,		  mapType: 'styledMap',		  showTooltip: true,			showInfoWindow: true,			useMapTypeControl: true,			maps: {			  // Your custom mapTypeId holding custom map styles.			  styledMap: {				name: 'Styled Map', // This name will be displayed in the map type control.				styles: [				  {featureType: 'poi.attraction',				   stylers: [{color: '#fce8b2'}]				  },				  {featureType: 'road.highway',				   stylers: [{hue: '#0277bd'}, {saturation: -50}]				  },				  {featureType: 'road.highway',				   elementType: 'labels.icon',				   stylers: [{hue: '#000'}, {saturation: 100}, {lightness: 50}]				  },				  {featureType: 'landscape',				   stylers: [{hue: '#259b24'}, {saturation: 10}, {lightness: -22}]				  }			]}}        });		const contentString ='Customer Location';		const infowindow = new google.maps.InfoWindow({			content: contentString,		  });        const iconBase =          "http://maps.google.com/mapfiles/ms/icons/";        const icons = {          parking: {            icon: iconBase + "blue-dot.png",          },          library: {            icon: iconBase + "library_maps.png",          },          info: {            icon: iconBase + "red-dot.png",          },        };        const features = [		<?php		$sqlselect = "SELECT id, latlong, consigneename From jrcconsignee where latlong!='' and latlong!='$latlong' order by consigneename asc";				          $queryselect = mysqli_query($connection, $sqlselect);        $rowCountselect = mysqli_num_rows($queryselect);                 if(!$queryselect){           die("SQL query failed: " . mysqli_error($connection));        }                 if($rowCountselect > 0) 		{			$count=1;			while($rowselect = mysqli_fetch_array($queryselect)) 			{				?>          {            position: new google.maps.LatLng(<?=$rowselect['latlong']?>),            type: "info",			title: '<?=mysqli_real_escape_string($connection,$rowselect["consigneename"])?> <br><a target="_blank" href="consigneeview.php?id=<?=$rowselect["id"]?>">View</a>',          },		  <?php			}		}			?>			<?php			if($latlong!='')			{			?>          {            position: new google.maps.LatLng(			 <?=$latlong?>            ),			type: "parking",			title: 'Customer Location',          },		  <?php			}			?>        ];        // Create markers.        for (let i = 0; i < features.length; i++) {          const marker = new google.maps.Marker({            position: features[i].position,            icon: icons[features[i].type].icon,            map: map,			title: features[i].title,          });		  google.maps.event.addListener(marker, "click", function(evt) {  			infowindow.setContent(this.get('title'));			infowindow.open(map,this);			});         }      }    </script></head><body id="page-top">    <div id="wrapper">        <?php include('sidebar.php');?>            <div id="content-wrapper" class="d-flex flex-column">            <div id="content">                  <?php include('navbar.php');?>                        <div class="container-fluid">          <!-- Page Heading --><div class="d-sm-flex align-items-center justify-content-between mb-2">            <h1 class="h4 mb-0 text-gray-800">Add New Complaint Call</h1>            <a href="calls.php" class="m-2 d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i class="fas fa-list fa-sm text-white-50"></i> View All Complaint Call</a>          </div>		  <?phpif(isset($_GET['remarks'])){?>	<div class="col-lg-12 mb-2">                  <div class="card bg-success text-white shadow">                    <div class="card-body">                      <?=$_GET['remarks']?>                    </div>                  </div>                </div><?php} if(isset($_GET['error'])){?>	   <div class="col-lg-12 mb-2">                  <div class="card bg-danger text-white shadow">                    <div class="card-body">                     <?=$_GET['error']?>                    </div>                  </div>                </div><?php}?><?phpif(isset($_GET['id'])){$id=mysqli_real_escape_string($connection,$_GET['id']);$sqlselect = "SELECT * From jrcxl where tdelete='0' and  id='".$id."' order by consigneename asc";				          $queryselect = mysqli_query($connection, $sqlselect);        $rowCountselect = mysqli_num_rows($queryselect);                 if(!$queryselect){           die("SQL query failed: " . mysqli_error($connection));        }                 if($rowCountselect > 0) 		{			$count=1;			while($rowselect = mysqli_fetch_array($queryselect)) 			{			?>			<div class="row">        <div class="col-xl-12 order-xl-1 mb-5 mb-xl-0">          <div class="card card-profile shadow">            <div class="card-body">			  <div class="table-responsive">                 <table class="table table-bordered font-13" width="100%" cellspacing="0">                  <thead>                    <tr>					<?phpif($infolayoutcustomers['maincategory']=='1'){?>                      <th>Main Category</th>					  <?php}if($infolayoutcustomers['subcategory']=='1'){?>					  <th>Sub Category</th>					  <?php}if($infolayoutcustomers['department']=='1'){?>					  <th>Department</th>					  <?php}if($infolayoutcustomers['consigneename']=='1'){?>                      <th>Customer Name</th>					  <?php}if(($infolayoutcustomers['address1']=='1')||($infolayoutcustomers['address2']=='1')||($infolayoutcustomers['area']=='1')||($infolayoutcustomers['district']=='1')||($infolayoutcustomers['pincode']=='1')){?>                      <th>Address</th>					  <?php}if(($infolayoutcustomers['contact']=='1')||($infolayoutcustomers['phone']=='1')||($infolayoutcustomers['mobile']=='1')||($infolayoutcustomers['email']=='1')){?>					  <th>Contact</th>					  <?php}?>					  <th>Edit</th>                    </tr>                  </thead>                  <tbody>				                    <tr>					<?phpif($infolayoutcustomers['maincategory']=='1'){?>                      <td><?=$rowselect['maincategory']?></td>					  <?php}if($infolayoutcustomers['subcategory']=='1'){?>					  <td><?=$rowselect['subcategory']?></td>					  <?php}if($infolayoutcustomers['department']=='1'){?>					  <td><?=$rowselect['department']?></td>					  <?php}if($infolayoutcustomers['consigneename']=='1'){?>	                  <td><?=$rowselect['consigneename']?></td>					  <?php}if(($infolayoutcustomers['address1']=='1')||($infolayoutcustomers['address2']=='1')||($infolayoutcustomers['area']=='1')||($infolayoutcustomers['district']=='1')||($infolayoutcustomers['pincode']=='1')){?>					  <td><?=$rowselect['address1']?> <?=$rowselect['address2']?> <?=$rowselect['area']?> <?=$rowselect['district']?> <?=$rowselect['pincode']?></td>					  <?php}if(($infolayoutcustomers['contact']=='1')||($infolayoutcustomers['phone']=='1')||($infolayoutcustomers['mobile']=='1')||($infolayoutcustomers['email']=='1')){?>					  <td><?=$rowselect['contact']?> <?=$rowselect['phone']?> <?=$rowselect['mobile']?> <?=$rowselect['email']?></td>					  <?php}?>					  <td><a href="consigneeedit.php?id=<?=$rowselect['consigneeid']?>">Edit</a></td>                    </tr>				  </tbody>                </table>              </div>            </div>          </div>        </div>		</div><br>		<div class="row">		<div class="col-xl-12 order-xl-2 mb-5 mb-xl-0">          <div class="card card-profile shadow">            <div class="card-header text-center border-0 pt-8 pt-md-2 pb-0 pb-md-2">              <div class="d-flex justify-content-between">				<h5>Product Details</h5>              </div>            </div>            <div class="card-body pt-0 pt-md-4 font-13 text-center">                    <div class="row">					<?phpif(($infolayoutinvoice['invoiceno']=='1')||($infolayoutinvoice['invoicedate']=='1')){?>					<div class="col-xl-2" style="padding-bottom:10px;"><b>Invoice Details</b>					<br><?=$rowselect['invoiceno']?> <br> <?=($rowselect['invoicedate']!='')?(date('d/m/Y',strtotime($rowselect['invoicedate']))):''?><br><a href="invoiceedit.php?id=<?=$rowselect['id']?>">Edit</a></div><?php}if($infolayoutinvoice['tenderno']=='1'){?>											<div class="col-xl-2" style="padding-bottom:10px;"><b>Tender Details</b><br><?=$rowselect['tenderno']?></div><?php}if(($infolayoutinvoice['pono']=='1')||($infolayoutinvoice['podate']=='1')){?>										<div class="col-xl-2" style="padding-bottom:10px;"><b>PO Details</b>					<br><?=$rowselect['pono']?> <br> <?=($rowselect['podate']!='')?date('d/m/Y',strtotime($rowselect['podate'])):''?></div><?php}if(($infolayoutinvoice['dcno']=='1')||($infolayoutinvoice['dcdate']=='1')){?>										<div class="col-xl-2" style="padding-bottom:10px;"><b>DC Details</b>					<br><?=$rowselect['dcno']?> <br> <?=($rowselect['dcdate']!='')?date('d/m/Y',strtotime($rowselect['dcdate'])):''?></div><?php}if(($infolayoutinvoice['installedon']=='1')||($infolayoutinvoice['installedby']=='1')){?>										<div class="col-xl-2" style="padding-bottom:10px;"><b>Installation Details</b>					<br><?=($rowselect['installedon']!='')?date('d/m/Y',strtotime($rowselect['installedon'])):''?> <br> <?=$rowselect['installedby']?></div><?php}if($infolayoutinvoice['invoicedqty']=='1'){?>								<div class="col-xl-2" style="padding-bottom:10px;"><b>Invoiced Qty</b><br><?=$rowselect['invoicedqty']?></div><?php}?>										<div class="col-xl-2" style="padding-bottom:10px;"><b>Product Details</b>					<br>					<?=$rowselect['stockmaincategory']?> - <?=$rowselect['stocksubcategory']?><br><b class="text-danger"><?=$rowselect['stockitem']?></b><br>Overall Warranty: <?=$rowselect['overallwarranty']?>					  <?php					  if($rowselect['overallwarranty']!='')					  {						  if($rowselect['installedon']!='')						  {							  $overdate=$rowselect['installedon'];						  }						  else						  {							  $overdate=$rowselect['invoicedate'];						  }						  $off=(float)$rowselect['overallwarranty'];						  $overdate = str_replace('/', '-', $overdate);							$overdate=date('Y-m-d', strtotime($overdate));$effectiveDate = date('Y-m-d', strtotime("+$off months", strtotime($overdate)));$effectiveDate1=date('d/m/Y', strtotime($effectiveDate));						$date = new DateTime($effectiveDate);$now = new DateTime();if($date < $now) {    echo '<span class="text-danger"><b>('.$effectiveDate1.')</b></span>';}else{	echo '<span class="text-success"><b>('.$effectiveDate1.')</b></span>';}					  }					  ?>					 </div>										<?php					$serialnumbers=array();				  $sqlselect2 = "SELECT * From jrcxl where tdelete='0' and  id='".$id."' order by id asc";				          $queryselect2 = mysqli_query($connection, $sqlselect2);        $rowCountselect2 = mysqli_num_rows($queryselect2);                 if(!$queryselect2){           die("SQL query failed: " . mysqli_error($connection));        }                 if($rowCountselect2 > 0) 		{			$count=1;			$stockitem="";			while($rowselect2 = mysqli_fetch_array($queryselect2)) 			{			?>					<div class="col-xl-2" style="padding-bottom:10px;"><b>Product Item <?=$count?></b>					<br>					<?=$rowselect2['typeofproduct']?> - <?=$rowselect2['componenttype']?> - <?=$rowselect2['componentname']?><br>					  Make: <?=$rowselect2['make']?><br>                      Capacity: <?=$rowselect2['capacity']?><br>					  Warranty: <?=$rowselect2['warranty']?>					  <?php					  if($rowselect2['warranty']!='')					  {						  if($rowselect2['installedon']!='')						  {							  $overdate=$rowselect2['installedon'];						  }						  else						  {							  $overdate=$rowselect2['invoicedate'];						  }						  $off=(float)$rowselect2['warranty'];						  $overdate = str_replace('/', '-', $overdate);							$overdate=date('Y-m-d', strtotime($overdate));$effectiveDate = date('Y-m-d', strtotime("+$off months", strtotime($overdate)));$effectiveDate1=date('d/m/Y', strtotime($effectiveDate));$date = new DateTime($effectiveDate);$now = new DateTime();if($date < $now) {    echo '<span class="text-danger"><b>('.$effectiveDate1.')</b></span>';}else{	echo '<span class="text-success"><b>('.$effectiveDate1.')</b></span>';}					  }					  ?>					  <br>					  <?php				  $sqlamc = "SELECT * From jrcamc where sourceid='".$rowselect2['id']."'";				          $queryamc = mysqli_query($connection, $sqlamc);        $rowCountamc = mysqli_num_rows($queryamc);                 if(!$queryamc){           die("SQL query failed: " . mysqli_error($connection));        }		if($rowCountamc!=0)		{		?>		<b>AMC:</b><?php		         		$rowamc = mysqli_fetch_array($queryamc); 		$date = new DateTime($rowamc['dateto']);$now = new DateTime();if($date < $now) {    echo '<span class="text-danger"><strong><br>('.date('d/m/Y',strtotime($rowamc['datefrom'])).' - '.date('d/m/Y',strtotime($rowamc['dateto'])).'<br>'.$rowamc['amcduration'].' Months - '.$rowamc['amctype'].' Maintanence)</strong></span>';}else{	echo '<span class="text-success"><strong><br>('.date('d/m/Y',strtotime($rowamc['datefrom'])).' - '.date('d/m/Y',strtotime($rowamc['dateto'])).'<br>'.$rowamc['amcduration'].' Months - '.$rowamc['amctype'].' Maintanence)</strong></span>';	?>	<script>	document.getElementById("amccustomer").style.display="block";	</script>	<?php	}		}		?>					  </div>					<div class="col-xl-2" style="padding-bottom:10px;"><b>Serial Numbers</b><br><?=str_replace("\n","<br>",$rowselect2['serialnumber'])?></div>				                  <?php				  $sl=str_replace('|',"*",$rowselect2['serialnumber']);				  $sl=str_replace('\n',"*",$sl);				  //$sernumbers = preg_split('/(@|*)/', $sl);				  $sernumbers=explode("* ",$sl);				  if(!empty($sernumbers))				  {					  foreach($sernumbers as $ser)					  {						  $serialnumbers[]=$ser;					  }				  }				  $count++;			}		}		?>				</div>					              </div>          </div>        </div>		</div><br>		<div class="row">		<div class="col-xl-12 order-xl-2 mb-5 mb-xl-0">          <div class="card card-profile shadow">            <div class="card-header text-center border-0 pt-8 pt-md-2 pb-0 pb-md-2">              <div class="d-flex justify-content-between">                <h5>Call History</h5>              </div>            </div>            <div class="card-body pt-0 pt-md-4">              			 <div class="table-responsive font-13">                <table class="table table-bordered font-13" id="dataTable" width="100%" cellspacing="0">                  <thead>                    <tr>                      <th>S.No</th>                      <th>Call ID and Date</th>                      <th>Call Details</th>					  <th>Customer Details</th>					  <th>Product Details</th>					  <th>Problem Details</th>					  <th>Status</th>					  <?php					  if($calledit=='1')					  {						?>  					  <th>Action</th>					  <?php					  }					  ?>                    </tr>                  </thead>                  <tbody>		 <?php		$sqlcall = "SELECT sourceid, callfrom, callon, calltid, acknowlodge, compstatus, changeon, id, callhandlingid, callhandlingname, coordinatorid, coordinatorname, engineerid,engineername, engineertype, engineersname, engineersid, reportingtype, reportingengineerid, reportingengineername, callnature, customernature, serial, reportedproblem, problemobserved, actiontaken, narration, detailsid From jrccalls where sourceid='".$id."' order by id desc";		$querycall = mysqli_query($connection, $sqlcall);        $rowCountcall = mysqli_num_rows($querycall);                 if(!$querycall){           die("SQL query failed: " . mysqli_error($connection));        }                 if($rowCountcall > 0) 		{			$count=1;			while($rowcall = mysqli_fetch_array($querycall)) 			{				$sqlxl = "SELECT consigneeid, consigneename, stockmaincategory, stocksubcategory, componentname, stockitem From jrcxl where id='".$rowcall['sourceid']."' order by id asc";				$queryxl = mysqli_query($connection, $sqlxl);				$rowCountxl = mysqli_num_rows($queryxl);				 				if(!$queryxl){				   die("SQL query failed: " . mysqli_error($connection));				}				 									$rowxl = mysqli_fetch_array($queryxl);								$consigneeid=mysqli_real_escape_string($connection,$rowxl['consigneeid']);				  $sqlcons = "SELECT address1, address2, area, district, pincode, contact, phone, mobile, email From jrcconsignee where id='".$consigneeid."' order by consigneename asc";				          $querycons = mysqli_query($connection, $sqlcons);        $rowCountcons = mysqli_num_rows($querycons);                 if(!$querycons){           die("SQL query failed: " . mysqli_error($connection));        }        $rowcons = mysqli_fetch_array($querycons);		if(($infocompany1['encsystem']=='1')||($infocompany1['encsystem']=='2')){	if((isset($_SESSION['encpass']))&&($_SESSION['encpass']!=""))	{				if($rowcons['address1']!='')		{		$rowcons['address1']=jbsdecrypt($_SESSION['encpass'], $rowcons['address1']);		}		if($rowcons['phone']!='')		{		$rowcons['phone']=jbsdecrypt($_SESSION['encpass'], $rowcons['phone']);		}		if($rowcons['mobile']!='')		{		$rowcons['mobile']=jbsdecrypt($_SESSION['encpass'], $rowcons['mobile']);		}		if($rowcons['email']!='')		{		$rowcons['email']=jbsdecrypt($_SESSION['encpass'], $rowcons['email']);		}	}}		?>                    					  					<tr>                      <td> <?=(date('Y-m-d')==date('Y-m-d',strtotime($rowcall['callon'])))?'<span class="bg-primary text-white" style="width:50px; height:50px; border-radius:50%; padding:5px 10px;">'.$count.'</span>':$count?></td>                      <td style="text-align:center;"><a class="modalButton" style="color:#3d8eb9; cursor:pointer" onclick="searchhistory('<?php echo $rowcall['calltid'];?>')"><?=$rowcall['calltid']?></a>					  <br>					  <?=$rowcall['callfrom']?><br>					  <?=date('d/m/Y h:i:s a', strtotime($rowcall['callon']))?>					  <br><?php					  if($rowcall['acknowlodge']=='1')					  {						  ?>						  <span class="badge badge-primary">Approved</span>						  <?php					  }					  else					  {						  ?>						  <span class="badge badge-default shadow">Wait for Appr.</span>						  <?php					  }					  ?>					  </td>					  					  <td> 					  C/H: <a href="callhandlingview.php?id=<?=$rowcall['callhandlingid']?>"><?=$rowcall['callhandlingname']?></a><br>					  C/O: <a href="coordinatorview.php?id=<?=$rowcall['coordinatorid']?>"><?=$rowcall['coordinatorname']?></a><br>					  E: <a href="mapengineerview.php?id=<?=$rowcall['engineerid']?>&attdate=<?=date('Y-m-d')?>"><?=$rowcall['engineername']?></a><br>					  <?php					  if($rowcall['customernature']!='')					 {							 ?>						   <span class="btn btn-sm btn-info"><?=$rowcall['customernature']?></span><br>						   <?php						  					 }					 if($rowcall['callnature']!='')					 {							 ?>						   <span class="btn btn-sm btn-primary"><?=$rowcall['callnature']?></span><br>						   <?php						  					 }					  if($rowcall['compstatus']!='2')					  {						 if($callchange=='1')						{  					  ?>					  <a href="callsmodify.php?id=<?=$rowcall['id']?>" class="text-warning">Change Details</a>					 <?php						}					  }					  ?>					  </td>					   <?php					  if($rowxl['consigneename']!="")					  {						?>                      <td><a href="consigneeview.php?id=<?=$rowxl['consigneeid']?>"><?=$rowxl['consigneename']?></a><br><?=$rowcons['address1']?> <?=$rowcons['address2']?> <?=$rowcons['area']?> <?=$rowcons['district']?> <?=$rowcons['pincode']?>  <?=$rowcons['contact']?>  <?=$rowcons['phone']?> <?=$rowcons['mobile']?></td>					  <?php					  }					  else					  {					  ?>					  <td><a href="consigneeview.php?id=<?=$rowxl['consigneeid']?>">View</a></td>					  <?php					  }					  ?>					  <td><?=$rowxl['stocksubcategory']?> - <span class="text-primary"><?=$rowxl['stockitem']?></span><br><b>Serial:</b> <?=$rowcall['serial']?></td>					  <td><b>Reported:</b> <?=$rowcall['reportedproblem']?><br>					  <b>Observed:</b> <?=$rowcall['problemobserved']?><br>					  <b>Action:</b> <?=$rowcall['actiontaken']?><br>					  <b>Narration:</b> <?=$rowcall['narration']?></td>					  					  <td>					  <?php					  if($rowcall['compstatus']=='2')					  {						?>						<span class="text-success">Completed </span>on <?=date('d/m/Y h:i:s a', strtotime($rowcall['changeon']))?>						<?php											  }					  else if($rowcall['compstatus']=='1')					  {						?>						<span class="text-danger">Pending </span>on <?=date('d/m/Y h:i:s a', strtotime($rowcall['changeon']))?>						<?php											  }					  else					 {						?>						<span class="text-warning">Open</span>						<?php											  }					  ?>					  </td>					  <?php					  if($calledit=='1')					  {						 if($rowcall['compstatus']!='2')						  { 					  ?>					  <td><a href="callsedit.php?id=<?=$rowcall['id']?>">Edit</a></td>					  <?php												  }						  else						  {							  ?>							  <td></td>							  <?php						  }					  }					  ?>                    </tr>				  					<?php					$count++;			}		}			?>					                  </tbody>                </table>              </div>			              </div>          </div>        </div>              </div>		<br>		<div id="call" class="row">		<div class="col-xl-6 order-xl-2 mb-5 mb-xl-0">		<div class="card card-profile shadow">            <div class="card-header text-center border-0 pt-8 pt-md-2 pb-0 pb-md-2">              <div class="d-flex justify-content-between">                <h5>Nearby Engineers</h5>              </div>            </div>            <div class="card-body pt-0 pt-md-4">			<div id="map_div" style="width: 100%; height: 400px"></div>			</div>		</div>		</div>		<div class="col-xl-6 order-xl-2 mb-5 mb-xl-0">		<div class="card card-profile shadow">            <div class="card-header text-center border-0 pt-8 pt-md-2 pb-0 pb-md-2">              <div class="d-flex justify-content-between">                <h5>Nearby Customers</h5>              </div>            </div>            <div class="card-body pt-0 pt-md-4">			<div id="map_div2" style="width: 100%; height: 400px"></div>			</div>		</div>		</div>		</div>		<br>		<div class="row">		<div class="col-xl-12 order-xl-2 mb-5 mb-xl-0">          <div class="card card-profile shadow">            <div class="card-header text-center border-0 pt-8 pt-md-2 pb-0 pb-md-2">              <div class="d-flex justify-content-between">                <h5>Call Details</h5>              </div>            </div>            <div class="card-body pt-0 pt-md-4">              			  <form method="post" action="callsadds.php">			  <input type="hidden" id="consigneeid" name="consigneeid" value="<?=$rowselect['consigneeid']?>">			  <input type="hidden" id="sourceid" name="sourceid" value="<?=$rowselect['id']?>">			  <?php			  if(isset($_GET['ts1']))			  {				?>				<input type="hidden" id="ts1" name="ts1" value="<?=$_GET['ts1']?>">				<?php							  }			  ?><div class="row"><?phpif($infolayoutcall['businesstype']=='1'){?>		<div class="col-lg-2 mb-3"><label for="businesstype">Business Type:</label></div><div class="col-lg-10 mb-3"><?phpif($businesstype!=''){$businesstypes=explode(',',$businesstype);foreach($businesstypes as $btype){?>	<label class="mr-2"><input type="radio" name="businesstype" value="<?=$btype?>" <?=($infolayoutcall['businesstypereq']=='1')?'required':''?>> <?=$btype?> </label><?php}}?></div><?php}else{	?>	<input type="hidden" name="businesstype" id="businesstype" value="">	<?php}if($infolayoutcall['servicetype']=='1'){?><div class="col-lg-2 mb-3"><label for="servicetype">Service Type:</label></div><div class="col-lg-10 mb-3"><label class="mr-2"><input type="radio" name="servicetype" <?=((isset($_GET['ts']))&&(($_GET['ts']=='amcmaintenance')||($_GET['ts']=='amcexpire')))?'checked':''?> value="On-Site" <?=($infolayoutcall['servicetypereq']=='1')?'required':''?>> On-Site </label><label class="mr-2"><input type="radio" name="servicetype" value="Carry-In" <?=($infolayoutcall['servicetypereq']=='1')?'required':''?>> Carry-In </label></div><?php}else{	?>	<input type="hidden" name="servicetype" id="servicetype" value="">	<?php}if($infolayoutcall['customernature']=='1'){?><div class="col-lg-2 mb-3"><label for="customernature">Customer Nature:</label></div><div class="col-lg-10 mb-3"><label class="mr-2"><input type="radio" name="customernature" <?=((isset($_GET['ts']))&&(($_GET['ts']=='amcmaintenance')||($_GET['ts']=='amcexpire')))?'checked':''?> value="AMC" <?=($infolayoutcall['customernaturereq']=='1')?'required':''?>> AMC </label><label class="mr-2"><input type="radio" name="customernature" <?=((isset($_GET['ts']))&&(($_GET['ts']=='preventive')||($_GET['ts']=='warrantyexpire')))?'checked':''?> value="Warranty" <?=($infolayoutcall['customernaturereq']=='1')?'required':''?>> Warranty </label><label class="mr-2"><input type="radio" name="customernature" value="Out of Warranty" <?=($infolayoutcall['customernaturereq']=='1')?'required':''?>> Out of Warranty </label><label class="mr-2"><input type="radio" name="customernature" value="Other Make" <?=($infolayoutcall['customernaturereq']=='1')?'required':''?>> Other Make</label></div><?php}else{	?>	<input type="hidden" name="customernature" id="customernature" value="">	<?php}if($infolayoutcall['calltype']=='1'){?><div class="col-lg-2 mb-3"><label for="callnature">Call Type:</label></div><div class="col-lg-4 mb-3" style="border-right:1px solid #cccccc"><label class="mr-2"><input type="radio" name="calltype" value="Service Call" <?=($infolayoutcall['calltypereq']=='1')?'required':''?>> Service Call (Received from Customer) </label></div><div class="col-lg-6 mb-3"><label class="mr-2"><input type="radio" name="calltype" <?=((isset($_GET['ts']))&&(($_GET['ts']=='preventive')||($_GET['ts']=='warrantyexpire')||($_GET['ts']=='amcmaintenance')||($_GET['ts']=='amcexpire')))?'checked':''?> value="Other Call" <?=($infolayoutcall['calltypereq']=='1')?'required':''?>> Other Call (Service Related Activities) </label></div><?php}else{	?>	<input type="hidden" name="calltype" id="calltype" value="">	<?php}if($infolayoutcall['callnature']=='1'){?><div class="col-lg-2 mb-3"><label for="callnature">Call Nature:</label></div><div class="col-lg-4 mb-3" style="border-right:1px solid #cccccc"><label class="mr-2"><input type="radio" name="callnature" value="Complaint" <?=($infolayoutcall['callnaturereq']=='1')?'required':''?>> Complaint </label><label class="mr-2"><input type="radio" name="callnature" value="Re-Installation" <?=($infolayoutcall['callnaturereq']=='1')?'required':''?>> Re-Installation </label></div><div class="col-lg-6 mb-3"><label class="mr-2"><input type="radio" name="callnature" value="DC Sign Work" <?=($infolayoutcall['callnaturereq']=='1')?'required':''?>> DC Sign Work </label><label class="mr-2"><input type="radio" name="callnature" value="Site Survey" <?=($infolayoutcall['callnaturereq']=='1')?'required':''?>> Site Survey </label><label class="mr-2"><input type="radio" name="callnature" value="Delivery" <?=($infolayoutcall['callnaturereq']=='1')?'required':''?>> Delivery </label><label class="mr-2"><input type="radio" name="callnature" value="Installation" <?=($infolayoutcall['callnaturereq']=='1')?'required':''?>> Installation </label><label class="mr-2"><input type="radio" name="callnature" <?=((isset($_GET['ts']))&&(($_GET['ts']=='preventive')||($_GET['ts']=='warrantyexpire')||($_GET['ts']=='amcmaintenance')||($_GET['ts']=='amcexpire')))?'checked':''?> value="Maintanence" <?=($infolayoutcall['callnaturereq']=='1')?'required':''?>> Maintanence </label></div><?php}else{	?>	<input type="hidden" name="callnature" id="callnature" value="">	<?php}if($infolayoutcall['callfrom']=='1'){?><div class="col-lg-4">  <div class="form-group">    <label for="callfrom">Call Received From (Contact Number)</label>	<?php	if($rowselect['mobile']!="")	{		$phono = preg_replace("/[^0-9]/", "", mysqli_real_escape_string($connection,$rowselect['mobile']) );	}	else	{		$phono="";	}	?>    <input type="text" class="form-control" id="callfrom" name="callfrom"  value="<?=$phono?>" <?=($infolayoutcall['callfromreq']=='1')?'required':''?>>  </div></div><?php}else{	?>	<input type="hidden" name="callfrom" id="callfrom" value="">	<?php}if($infolayoutcall['callon']=='1'){?><div class="col-lg-4">    <div class="form-group">    <label for="callon">Call Received On</label>    <input type="text" class="form-control" id="callon" name="callon" readonly  value="<?=date('Y-m-d H:i:s')?>" <?=($infolayoutcall['callonreq']=='1')?'required':''?>>  </div>  </div><?php}else{	?>	<input type="hidden" name="callon" id="callon" value="">	<?php}if($infolayoutcall['callhandling']=='1'){?>    <div class="col-lg-4">  <div class="form-group">    <label for="callhandlingname">Call Handled By</label>	<input type="hidden" id="callhandlingid" name="callhandlingid" <?=($infolayoutcall['callhandlingreq']=='1')?'required':''?>>    <input type="text" class="form-control" id="callhandlingname" name="callhandlingname" maxlength="3"  <?=($infolayoutcall['callhandlingreq']=='1')?'required':''?>>  </div>   </div><?php}else{	?>	<input type="hidden" name="callhandlingid" id="callhandlingid" value="">	<input type="hidden" name="callhandlingname" id="callhandlingname" value="">	<?php}if($infolayoutcall['reportedproblem']=='1'){?>  <div class="col-lg-4">      <div class="form-group">    <label for="reportedproblem">Reported Problem</label><select class="form-control" id="reportedproblem" name="reportedproblem" <?=($infolayoutcall['reportedproblemreq']=='1')?'required':''?>><option value="">Select</option><?php$sqlrep = "SELECT * From jrcreportedproblem order by reportedproblem asc";				          $queryrep = mysqli_query($connection, $sqlrep);        $rowCountrep = mysqli_num_rows($queryrep);                 if(!$queryrep){           die("SQL query failed: " . mysqli_error($connection));        }                 if($rowCountrep > 0) 		{			$count=1;			while($rowrep = mysqli_fetch_array($queryrep)) 			{				?><option value="<?=$rowrep['reportedproblem']?>" <?=((isset($_GET['t']))&&($_GET['t']=='wm')&&($rowrep['reportedproblem']=='WARRANTY MAINTENANCE'))?'selected':''?> <?=((isset($_GET['ts']))&&(($_GET['ts']=='preventive')||($_GET['ts']=='warrantyexpire'))&&($rowrep['reportedproblem']=='WARRANTY MAINTENANCE'))?'selected':''?> <?=((isset($_GET['t']))&&($_GET['t']=='am')&&($rowrep['reportedproblem']=='AMC MAINTENANCE'))?'selected':''?>><?=$rowrep['reportedproblem']?></option><?php			}		}		?></select>  </div>  </div><?php}else{	?>	<input type="hidden" name="reportedproblem" id="reportedproblem" value="">	<?php}if($infolayoutcall['coordinator']=='1'){?>  <div class="col-lg-4">      <div class="form-group">    <label for="coordinatorname">Co-Ordinator Assigned</label>	<input type="hidden" id="coordinatorid" name="coordinatorid" <?=($infolayoutcall['coordinatorreq']=='1')?'required':''?>>    <input type="text" class="form-control" id="coordinatorname" name="coordinatorname" maxlength="3"  <?=($infolayoutcall['coordinatorreq']=='1')?'required':''?>>  </div>  </div><?php}else{	?>	<input type="hidden" name="coordinatorid" id="coordinatorid" value="">	<input type="hidden" name="coordinatorname" id="coordinatorname" value="">	<?php}if($infolayoutcall['engineer']=='1'){?><div class="col-lg-4">  <div class="form-group">    <label for="engineername">Engineer Assigned</label>	<input type="hidden" id="engineerid" name="engineerid" <?=($infolayoutcall['engineerreq']=='1')?'required':''?>>   <input type="text" class="form-control" id="engineername" name="engineername" maxlength="3"  <?=($infolayoutcall['engineerreq']=='1')?'required':''?>>  </div>   </div><?php}else{	?>	<input type="hidden" name="engineerid" id="engineerid" value="">	<input type="hidden" name="engineername" id="engineername" value="">	<?php}if($infolayoutcall['otherremarks']=='1'){?><div class="col-lg-6">      <div class="form-group">    <label for="otherremarks">Other Remarks</label>    <textarea type="text" class="form-control" id="otherremarks" name="otherremarks"  <?=($infolayoutcall['otherremarksreq']=='1')?'required':''?>></textarea>  </div>  </div><?php}else{	?>	<input type="hidden" name="otherremarks" id="otherremarks" value="">	<?php}if($infolayoutcall['serial']=='1'){?>  <div class="col-lg-6">  <div class="form-group">    <label for="serial">Serial Number </label>	<select class="fav_clr form-control" name="serial" id="serial" <?=($infolayoutcall['serialreq']=='1')?'required':''?>>	<?php	$sqlserial = "SELECT * From jrcserials where sourceid='".$_GET['id']."' and sstatus='0' order by serialqty asc";				          $queryserial = mysqli_query($connection, $sqlserial);        $rowCountserial = mysqli_num_rows($queryserial);                 if(!$queryserial){           die("SQL query failed: " . mysqli_error($connection));        }                 if($rowCountserial > 0) 		{			$count=1;			while($rowserial = mysqli_fetch_array($queryserial)) 			{				?>				<option value="<?=$rowserial['serialnumber']?>"><?=$rowserial['serialnumber']?></option>				<?php				}		}	?>	<option value="Not Available">Not Available</option>	</select>  </div></div> <?php}else{	?>	<input type="hidden" name="serial" id="serial" value="">	<?php}if($infolayoutcall['sms']=='1'){?><div class="col-lg-12"><div class="form-group"><label><input type="checkbox" name="customersms" id="customersms" > Customer Message </label> | <input type="hidden" name="callhandledsms" id="callhandledsms"><label><input type="checkbox" name="coordinatorsms" id="coordinatorsms"> Co-Ordinator Message </label> | <label><input type="checkbox" name="engineersms" id="engineersms" > Engineer Message </label></div></div><hr><div class="col-lg-12"><div class="form-group"><label><input type="checkbox" name="customerwa" id="customerwa" > SMS </label> | <input type="hidden" name="callhandledwa" id="callhandledwa"><label><input type="checkbox" name="coordinatorwa" id="coordinatorwa"> Whatsapp </label> | <label><input type="checkbox" name="engineerwa" id="engineerwa" > Mail </label></div></div><hr><?php}?></div>  <input class="btn btn-primary" type="submit" name="submit" value="Submit"></form>			              </div>          </div>        </div>              </div><?php					$count++;			}		}		}			?>                   </div>               </div>                    <?php include('footer.php'); ?>           </div>       </div>        <a class="scroll-to-top rounded" href="#page-top"><i class="fas fa-angle-up"></i></a><a class="scroll-to-bottom rounded" href="#page-bottom"><i class="fas fa-angle-down"></i></a><a class="scroll-to-back rounded" href="javascript:history.go(-1)"><i class="fas fa-angle-left"></i></a>     <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">    <div class="modal-dialog" role="document">      <div class="modal-content">        <div class="modal-header">          <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>          <button class="close" type="button" data-dismiss="modal" aria-label="Close">            <span aria-hidden="true">×</span>          </button>        </div>        <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>        <div class="modal-footer">          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>          <a class="btn btn-primary" href="../logout.php">Logout</a>        </div>      </div>    </div>  </div>    <script src="../../1637028036/vendor/jquery/jquery.min.js"></script>  <script src="../../1637028036/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>    <script src="../../1637028036/vendor/jquery-easing/jquery.easing.min.js"></script>    <script src="../../1637028036/js/aarkayen-jrc-2.min.js"></script><script src="notification.js"></script>  <!-- Page level plugins -->  <script src="../../1637028036/vendor/chart.js/Chart.min.js"></script> <script src="../../1637028036/vendor/chart.js/chartjs-plugin-labels.js"></script>  <!-- Page level plugins -->  <script src="../../1637028036/vendor/datatables/jquery.dataTables.min.js"></script>  <script src="../../1637028036/vendor/datatables/dataTables.bootstrap4.min.js"></script>  <!-- Page level custom scripts -->  <script src="../../1637028036/js/datatables.js"></script>  <script src="../../1637028036/vendor/jquery-ui/jquery-ui.min.js"></script><script src="../../1637028036/vendor/select2/js/select2.min.js" type="text/javascript"></script> <script      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADrEUFitIjcVlPbcDdbuW7Ul7a15n0TUg&callback=initMap&libraries=&v=weekly"      async    ></script><script type="text/javascript">  $(function() {     $( "#topsearch" ).autocomplete({       source: 'topsearch.php', select: function (event, ui) { $("#topsearch").val(ui.item.value); $("#topsearchid").val(ui.item.id);}, minLength: 3     });$( "#topsearch1" ).autocomplete({       source: 'topsearch.php', select: function (event, ui) { $("#topsearch1").val(ui.item.value); $("#topsearchid1").val(ui.item.id);}, minLength: 3     });	 $( "#callhandlingname" ).autocomplete({       source: 'callsearch.php', select: function (event, ui) { $("#callhandlingname").val(ui.item.value); $("#callhandlingid").val(ui.item.id);}     });     $( "#coordinatorname" ).autocomplete({       source: 'coorsearch.php', select: function (event, ui) { $("#coordinatorname").val(ui.item.value); $("#coordinatorid").val(ui.item.id);}     });	 $( "#engineername" ).autocomplete({       source: 'engsearch.php', select: function (event, ui) { $("#engineername").val(ui.item.value); $("#engineerid").val(ui.item.id);}     });	   });     $(document).ready(function() {    $('.fav_clr').select2({width: '100%',  allowClear: true,  placeholder: ''    });});  $('.fav_clr').on("select2:select", function (e) {            var data = e.params.data.text;           if(data=='all'){            $(".fav_clr > option").prop("selected","selected");            $(".fav_clr").trigger("change");           }      });	  function searchhistory(id)   {        var id=id;                $.ajax({            url:"searchcallhistory.php",            method:"post",            data:{id:id},            success:function(response){                $("#callhistorybody").html(response);                $("#dynamicModal").modal('show');             }        })     }	$(document).ready(function () {    // Handler for .ready() called.    $('html, body').animate({        scrollTop: $('#call').offset().top    }, 'slow');});</script></body></html>