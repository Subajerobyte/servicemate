<?phperror_reporting(E_ALL);ini_set('display_errors', TRUE);ini_set('display_startup_errors', TRUE);if (PHP_SAPI == 'cli')	die('This example should only be run from a Web Browser');require_once '../1637028036/vendor/excel1/Classes/PHPExcel.php';	function convertXLStoCSV($infile,$outfile){	$fileType = PHPExcel_IOFactory::identify($infile);	$objReader = PHPExcel_IOFactory::createReader($fileType);	$objReader->setReadDataOnly(false); 	$objPHPExcel = $objReader->load($infile);    	$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'CSV');	$objWriter->save($outfile);}    // Database connection	include('session.php');    include('mukkiyam/db.php');    global $wrongPwdErr, $accountNotExistErr, $emailPwdErr, $verificationRequiredErr, $email_empty_err, $pass_empty_err;    if(isset($_POST['login'])) 	{        $email_signin        = $_POST['email_signin'];        $password_signin     = md5($_POST['password_signin']);        // clean data         $user_email = filter_var($email_signin, FILTER_SANITIZE_EMAIL);        $pswd = mysqli_real_escape_string($connection, $password_signin);        $sql = "SELECT * From jrcadminuser WHERE username = '{$email_signin}' ";        $query = mysqli_query($connection, $sql);        $rowCount = mysqli_num_rows($query);        if(!$query){           die("SQL query failed: " . mysqli_error($connection));        }        if(!empty($email_signin) && !empty($password_signin)){            if(!preg_match("/^(?=.*\d)(?=.*[@#\-_$%^&+=ยง!\?])(?=.*[a-z])(?=.*[A-Z])[0-9A-Za-z@#\-_$%^&+=ยง!\?]{6,20}$/", $pswd)) {                $wrongPwdErr = '<div class="alert alert-danger">                        Password should be between 6 to 20 charcters long, contains atleast one special chacter, lowercase, uppercase and a digit.                    </div>';            }            if($rowCount <= 0) {				/////////////////////engineer				if(isset($_POST['login'])) 				{					$email_signin        = $_POST['email_signin'];					$password_signin     = md5($_POST['password_signin']);					// clean data 					$user_email = filter_var($email_signin, FILTER_SANITIZE_EMAIL);					$pswd = mysqli_real_escape_string($connection, $password_signin);					if(!empty($email_signin) && !empty($password_signin))					{						if(!preg_match("/^(?=.*\d)(?=.*[@#\-_$%^&+=ยง!\?])(?=.*[a-z])(?=.*[A-Z])[0-9A-Za-z@#\-_$%^&+=ยง!\?]{6,20}$/", $pswd)) {							$wrongPwdErr = '<div class="alert alert-danger">									Password should be between 6 to 20 charcters long, contains atleast one special chacter, lowercase, uppercase and a digit.								</div>';						}						$sql = "SELECT * From jrcengineer WHERE username = '{$email_signin}' ";						$query = mysqli_query($connection, $sql);						$rowCount = mysqli_num_rows($query);						if(!$query){						   die("SQL query failed: " . mysqli_error($connection));						}						if($rowCount > 0)  {							// Fetch user data and store in php session							while($row = mysqli_fetch_array($query)) {								$id            = $row['id'];								$engineername     = $row['engineername'];								$designation      = $row['designation'];								$email         = $row['username'];								$pass_word     = $row['password'];								$useremail=$email;								$address1     = $row['address1'];								$address2     = $row['address2'];								$area     = $row['area'];								$district     = $row['district'];								$pincode     = $row['pincode'];								$contact     = $row['contact'];								$mobile   = $row['mobile'];								$phone     = $row['phone'];								$avatar     = $row['avatar'];								$latlong         = $row['latlong'];								$enabled     = $row['enabled'];							}							if($enabled == '0') {								if($email_signin == $email && $password_signin == md5($pass_word)) {								$sqltime = "INSERT INTO jrclogin (user, ipaddress, times) VALUES ('{$useremail}', '{$ip}', '{$times}')";								// Create mysql query								$sqlQuerytime = mysqli_query($connection, $sqltime);								if(!$sqlQuerytime){									die("MySQL query failed!" . mysqli_error($connection));								} 								// Send verification email								if($sqlQuerytime) {									$sqlHistory =mysqli_query($connection, "INSERT INTO jrchistory (user, ipaddress, times, remarks) VALUES ('{$email}', '{$ip}', '{$times}', 'Logged in')");								$_SESSION['id'] = $id;								   $_SESSION['logged_in'] = '1';								   $_SESSION['engineername'] = $engineername;								   $_SESSION['designation'] = $designation;								   $_SESSION['address1'] = $address1;								   $_SESSION['address2'] = $address2;								   $_SESSION['area'] = $area;								   $_SESSION['district'] = $district;								   $_SESSION['pincode'] = $pincode;								   $_SESSION['contact'] = $contact;								   $_SESSION['phone'] = $phone;								   $_SESSION['mobile'] = $mobile;								   $_SESSION['avatar'] = $avatar;								   $_SESSION['email'] = $email;								   $_SESSION['kadavuchol'] = md5($pass_word);								   if(isset($_POST['rememberme']))								   {								   setcookie("payanalar", $email, time() + (86400 * 30 * 30), "/");								   setcookie("kadavuchol", md5($pass_word), time() + (86400 * 30 * 30), "/");								   setcookie("rememberme", $_POST['rememberme'], time() + (86400 * 30 * 30), "/");								   }								   $_SESSION['latlong'] = $latlong;								   $_SESSION['enabled'] = $enabled;								   header("Location: 656e67696e6565726c6f67696e/dashboard.php");								}								} else {									$emailPwdErr = '<div class="alert alert-danger">											Either email or password is incorrect.										</div>';								}							} else {								$verificationRequiredErr = '<div class="alert alert-danger">										Account verification is required for login.									</div>';							}						}					} else {						if($email_signin==""){							$email_empty_err = "<div class='alert alert-danger email_alert'>										Email not provided.								</div>";						}						if($password_signin==""){							$pass_empty_err = "<div class='alert alert-danger email_alert'>										Password not provided.									</div>";						}            					}				}				/////////////////////engineer                $accountNotExistErr = '<div class="alert alert-danger">                        User account does not exist.                    </div>';            } else {                // Fetch user data and store in php session                while($row = mysqli_fetch_array($query)) {                     $id            = $row['id'];								$adminusername     = $row['adminusername'];								$designation      = $row['designation'];								$email         = $row['username'];								$pass_word     = $row['password'];								$useremail=$email;								$address1     = $row['address1'];								$address2     = $row['address2'];								$area     = $row['area'];								$district     = $row['district'];								$pincode     = $row['pincode'];								$contact     = $row['contact'];								$mobile   = $row['mobile'];								$phone     = $row['phone'];								$avatar     = $row['avatar'];								$enabled     = $row['enabled'];                }                // Verify password                // Allow only verified user                if($enabled == '0') {					if($email_signin == $email && $password_signin == md5($pass_word)) {// Query                    $sqltime = "INSERT INTO jrclogin (user, ipaddress, times) VALUES ('{$useremail}', '{$ip}', '{$times}')";                    // Create mysql query                    $sqlQuerytime = mysqli_query($connection, $sqltime);                    if(!$sqlQuerytime){                        die("MySQL query failed!" . mysqli_error($connection));                    }                     // Send verification email                    if($sqlQuerytime) {						$sqlHistory =mysqli_query($connection, "INSERT INTO jrchistory (user, ipaddress, times, remarks) VALUES ('{$email}', '{$ip}', '{$times}', 'Logged in')");					$_SESSION['id'] = $id;								   $_SESSION['logged_in'] = '1';								   $_SESSION['adminusername'] = $adminusername;								   $_SESSION['designation'] = $designation;								   $_SESSION['address1'] = $address1;								   $_SESSION['address2'] = $address2;								   $_SESSION['area'] = $area;								   $_SESSION['district'] = $district;								   $_SESSION['pincode'] = $pincode;								   $_SESSION['contact'] = $contact;								   $_SESSION['phone'] = $phone;								   $_SESSION['mobile'] = $mobile;								   $_SESSION['avatar'] = $avatar;								   $_SESSION['email'] = $email;								   $_SESSION['kadavuchol'] = md5($pass_word);								   if(isset($_POST['rememberme']))								   {								   setcookie("payanalar", $email, time() + (86400 * 30 * 30), "/");								   setcookie("kadavuchol", md5($pass_word), time() + (86400 * 30 * 30), "/");								   setcookie("rememberme", $_POST['rememberme'], time() + (86400 * 30 * 30), "/");								   }								   								   $_SESSION['enabled'] = $enabled;						header("Location: 61646d696e6c6f67696e/dashboard.php");					}                    } else {                        $emailPwdErr = '<div class="alert alert-danger">                                Either email or password is incorrect.                            </div>';                    }                } else {                    $verificationRequiredErr = '<div class="alert alert-danger">                            Account verification is required for login.                        </div>';                }            }        } else {            if($email_signin==""){                $email_empty_err = "<div class='alert alert-danger email_alert'>                            Email not provided.                    </div>";            }            if($password_signin==""){                $pass_empty_err = "<div class='alert alert-danger email_alert'>                            Password not provided.                        </div>";            }                    }    }	if(isset($_COOKIE['payanalar'])) 	{         $email_signin        = $_COOKIE['payanalar'];        $password_signin     = $_COOKIE['kadavuchol'];        // clean data         $user_email = filter_var($email_signin, FILTER_SANITIZE_EMAIL);        $pswd = mysqli_real_escape_string($connection, $password_signin);        $sql = "SELECT * From jrcadminuser WHERE username = '{$email_signin}' ";        $query = mysqli_query($connection, $sql);        $rowCount = mysqli_num_rows($query);        if(!$query){           die("SQL query failed: " . mysqli_error($connection));        }        if(!empty($email_signin) && !empty($password_signin)){            if(!preg_match("/^(?=.*\d)(?=.*[@#\-_$%^&+=ยง!\?])(?=.*[a-z])(?=.*[A-Z])[0-9A-Za-z@#\-_$%^&+=ยง!\?]{6,20}$/", $pswd)) {                $wrongPwdErr = '<div class="alert alert-danger">                        Password should be between 6 to 20 charcters long, contains atleast one special chacter, lowercase, uppercase and a digit.                    </div>';            }            if($rowCount <= 0) {				/////////////////////engineer					$email_signin        = $_COOKIE['payanalar'];					$password_signin     = $_COOKIE['kadavuchol'];					// clean data 					$user_email = filter_var($email_signin, FILTER_SANITIZE_EMAIL);					$pswd = mysqli_real_escape_string($connection, $password_signin);										if(!empty($email_signin) && !empty($password_signin))					{						if(!preg_match("/^(?=.*\d)(?=.*[@#\-_$%^&+=ยง!\?])(?=.*[a-z])(?=.*[A-Z])[0-9A-Za-z@#\-_$%^&+=ยง!\?]{6,20}$/", $pswd)) {							$wrongPwdErr = '<div class="alert alert-danger">									Password should be between 6 to 20 charcters long, contains atleast one special chacter, lowercase, uppercase and a digit.								</div>';						}						$sql = "SELECT * From jrcengineer WHERE username = '{$email_signin}' ";						$query = mysqli_query($connection, $sql);						$rowCount = mysqli_num_rows($query);						if(!$query){						   die("SQL query failed: " . mysqli_error($connection));						}						if($rowCount > 0) {							// Fetch user data and store in php session							while($row = mysqli_fetch_array($query)) {								$id            = $row['id'];								$engineername     = $row['engineername'];								$designation      = $row['designation'];								$email         = $row['username'];								$pass_word     = $row['password'];								$useremail=$email;								$address1     = $row['address1'];								$address2     = $row['address2'];								$area     = $row['area'];								$district     = $row['district'];								$pincode     = $row['pincode'];								$contact     = $row['contact'];								$mobile   = $row['mobile'];								$phone     = $row['phone'];								$avatar     = $row['avatar'];								$latlong         = $row['latlong'];								$enabled     = $row['enabled'];							}							// Verify password			//                $password = password_verify($password_signin, $pass_word);							// Allow only verified user							if($enabled == '0') {								if($email_signin == $email && $password_signin == md5($pass_word)) {			// Query								$sqltime = "INSERT INTO jrclogin (user, ipaddress, times) VALUES ('{$useremail}', '{$ip}', '{$times}')";								// Create mysql query								$sqlQuerytime = mysqli_query($connection, $sqltime);								if(!$sqlQuerytime){									die("MySQL query failed!" . mysqli_error($connection));								} 								// Send verification email								if($sqlQuerytime) {									$sqlHistory =mysqli_query($connection, "INSERT INTO jrchistory (user, ipaddress, times, remarks) VALUES ('{$email}', '{$ip}', '{$times}', 'Logged in')");								$_SESSION['id'] = $id;								   $_SESSION['logged_in'] = '1';								   $_SESSION['engineername'] = $engineername;								   $_SESSION['designation'] = $designation;								   $_SESSION['address1'] = $address1;								   $_SESSION['address2'] = $address2;								   $_SESSION['area'] = $area;								   $_SESSION['district'] = $district;								   $_SESSION['pincode'] = $pincode;								   $_SESSION['contact'] = $contact;								   $_SESSION['phone'] = $phone;								   $_SESSION['mobile'] = $mobile;								   $_SESSION['avatar'] = $avatar;								   $_SESSION['email'] = $email;								   $_SESSION['kadavuchol'] = md5($pass_word);								   if(isset($_SESSION['rememberme']))								   {								   setcookie("payanalar", $email, time() + (86400 * 30 * 30), "/");								   setcookie("kadavuchol", md5($pass_word), time() + (86400 * 30 * 30), "/");								   setcookie("rememberme", $_POST['rememberme'], time() + (86400 * 30 * 30), "/");								   }																	   $_SESSION['latlong'] = $latlong;								   $_SESSION['enabled'] = $enabled;								   header("Location: 656e67696e6565726c6f67696e/dashboard.php");								}								} else {									$emailPwdErr = '<div class="alert alert-danger">											Either email or password is incorrect.										</div>';								}							} else {								$verificationRequiredErr = '<div class="alert alert-danger">										Account verification is required for login.									</div>';							}						}					} else {						if($email_signin==""){							$email_empty_err = "<div class='alert alert-danger email_alert'>										Email not provided.								</div>";						}						if($password_signin==""){							$pass_empty_err = "<div class='alert alert-danger email_alert'>										Password not provided.									</div>";						}            					}				/////////////////////engineer                $accountNotExistErr = '<div class="alert alert-danger">                        User account does not exist.                    </div>';            } else {                // Fetch user data and store in php session                while($row = mysqli_fetch_array($query)) {                    $id            = $row['id'];								$adminusername     = $row['adminusername'];								$designation      = $row['designation'];								$email         = $row['username'];								$pass_word     = $row['password'];								$useremail=$email;								$address1     = $row['address1'];								$address2     = $row['address2'];								$area     = $row['area'];								$district     = $row['district'];								$pincode     = $row['pincode'];								$contact     = $row['contact'];								$mobile   = $row['mobile'];								$phone     = $row['phone'];								$avatar     = $row['avatar'];								$enabled     = $row['enabled'];                }                // Verify password//                $password = password_verify($password_signin, $pass_word);                // Allow only verified user                if($enabled == '0') {					if($email_signin == $email && $password_signin == md5($pass_word)) {// Query                    $sqltime = "INSERT INTO jrclogin (user, ipaddress, times) VALUES ('{$useremail}', '{$ip}', '{$times}')";                    // Create mysql query                    $sqlQuerytime = mysqli_query($connection, $sqltime);                    if(!$sqlQuerytime){                        die("MySQL query failed!" . mysqli_error($connection));                    }                     // Send verification email                    if($sqlQuerytime) {						$sqlHistory =mysqli_query($connection, "INSERT INTO jrchistory (user, ipaddress, times, remarks) VALUES ('{$email}', '{$ip}', '{$times}', 'Logged in')");					$_SESSION['id'] = $id;								   $_SESSION['logged_in'] = '1';								   $_SESSION['adminusername'] = $adminusername;								   $_SESSION['designation'] = $designation;								   $_SESSION['address1'] = $address1;								   $_SESSION['address2'] = $address2;								   $_SESSION['area'] = $area;								   $_SESSION['district'] = $district;								   $_SESSION['pincode'] = $pincode;								   $_SESSION['contact'] = $contact;								   $_SESSION['phone'] = $phone;								   $_SESSION['mobile'] = $mobile;								   $_SESSION['avatar'] = $avatar;								   $_SESSION['email'] = $email;								   $_SESSION['kadavuchol'] = md5($pass_word);								   if(isset($_SESSION['rememberme']))								   {								   setcookie("payanalar", $email, time() + (86400 * 30 * 30), "/");								   setcookie("kadavuchol", md5($pass_word), time() + (86400 * 30 * 30), "/");								   setcookie("rememberme", $_POST['rememberme'], time() + (86400 * 30 * 30), "/");								   }								   $_SESSION['enabled'] = $enabled;						header("Location: 61646d696e6c6f67696e/dashboard.php");					}                    } else {                        $emailPwdErr = '<div class="alert alert-danger">                                Either email or password is incorrect.                            </div>';                    }                } else {                    $verificationRequiredErr = '<div class="alert alert-danger">                            Account verification is required for login.                        </div>';                }            }        } else {            if($email_signin==""){                $email_empty_err = "<div class='alert alert-danger email_alert'>                            Email not provided.                    </div>";            }            if($password_signin==""){                $pass_empty_err = "<div class='alert alert-danger email_alert'>                            Password not provided.                        </div>";            }                    }    }?>    